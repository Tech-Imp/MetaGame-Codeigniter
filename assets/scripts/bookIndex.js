// Generated by CoffeeScript 1.9.1
(function() {
  var bookIndex,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  bookIndex = (function() {
    bookIndex.prototype.debug = true;

    function bookIndex() {
      this.getData = bind(this.getData, this);
      this.getBooks = bind(this.getBooks, this);
      this.setupEvents = bind(this.setupEvents, this);
      if (this.debug) {
        console.log("bookIndex.constructor");
      }
      this.setupEvents();
      this.getBooks();
    }

    bookIndex.prototype.setupEvents = function() {
      if (this.debug) {
        console.log("bookIndex.setupEvents");
      }
      $(".modal").on("hidden.bs.modal", function() {
        console.log("Hiding");
        return $(".modal").removeData("bs.modal");
      });
      $("#myCart").unbind().bind("click", (function(_this) {
        return function(event) {
          return console.log("OVERRIDE");
        };
      })(this));
      return $(".unavail").unbind().bind("click", (function(_this) {
        return function(event) {
          alert("Sorry, these buttons would alter the database query appropriately, but theres no database for them to act on. They are unavailable for practical use in this demo.");
          return _this.getBooks();
        };
      })(this));
    };

    bookIndex.prototype.getBooks = function(genre) {
      if (genre == null) {
        genre = "all";
      }
      if (this.debug) {
        console.log("bookIndex.getBooks");
      }
      $("#bookDatabase").html("");
      return $.ajax({
        url: "get/getBook",
        type: 'post',
        dataType: 'json',
        data: {
          type: genre
        },
        success: (function(_this) {
          return function(response) {
            var book, i, len, ref, results;
            if (response.success) {
              ref = response.success;
              results = [];
              for (i = 0, len = ref.length; i < len; i++) {
                book = ref[i];
                results.push(new window.classes.bookObject(book.uid, book.title, book.auth, book.page, book.cost, book.stock, book.wish, book.img));
              }
              return results;
            } else if (response.debug) {
              new window.classes.bookObject(123, "20000 Leagues Under the Sea", "Jules Verne", 503, "$20", 13, 0);
              new window.classes.bookObject(456, "The Great Gatsby", "F. Scott Fitzgerald ", 320, "$15", 3, 1);
              new window.classes.bookObject(789, "Animal Farm", "George Orwell", 290, "$25", 1, 1);
              return new window.classes.bookObject(321, "The Hobbit", "J.R.R. Tolkien", 345, "$23", 0, 1);
            } else if (response.error) {
              return $("#bookDatabase").html("No books found.");
            }
          };
        })(this)
      });
    };

    bookIndex.prototype.getData = function(type) {
      if (type == null) {
        type = "changes";
      }
      if (this.debug) {
        console.log("bookIndex.getBooks");
      }
      $("#bookDatabase").html("");
      return $.ajax({
        url: "get/getData",
        type: 'post',
        dataType: 'json',
        data: {
          type: type
        },
        success: (function(_this) {
          return function(response) {
            var book, i, len, ref, results;
            if (response.success) {
              ref = response.success;
              results = [];
              for (i = 0, len = ref.length; i < len; i++) {
                book = ref[i];
                results.push(new window.classes.bookObject(book.uid, book.title, book.auth, book.page, book.cost, book.stock, book.wish, book.img));
              }
              return results;
            } else if (response.debug) {
              new window.classes.bookObject(123, "20000 Leagues Under the Sea", "Jules Verne", 503, "$20", 13, 0);
              new window.classes.bookObject(456, "The Great Gatsby", "F. Scott Fitzgerald ", 320, "$15", 3, 1);
              new window.classes.bookObject(789, "Animal Farm", "George Orwell", 290, "$25", 1, 1);
              return new window.classes.bookObject(321, "The Hobbit", "J.R.R. Tolkien", 345, "$23", 0, 1);
            } else if (response.error) {
              return $("#bookDatabase").html("No books found.");
            }
          };
        })(this)
      });
    };

    return bookIndex;

  })();

  if (window.classes == null) {
    window.classes = {};
  }

  window.classes.bookIndex = bookIndex;

  if (window.objs == null) {
    window.objs = {};
  }

  $(document).ready(function() {
    return window.objs.bookIndex = new bookIndex;
  });

}).call(this);
